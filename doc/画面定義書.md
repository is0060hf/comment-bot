# 画面定義書（CLI＋Next.js UI, Vercel）

- 版: v0.2
- 作成日: 2025-10-11
- 根拠: `doc/要件定義書.md`
- 方針: Next.js（App
  Router）をVercelにホスティング。外部APIはサーバーサイドのみ。A案のためYouTube投稿はローカルで実行

---

## 1. CLI 画面/コマンド定義（不変）

### 1.1 起動

- コマンド: `comment-bot start --config ./config.yaml`
- 表示: 起動成功/エラー、選択STT/LLM/安全レベル、入力デバイス名
- 動作: 必要に応じてローカルのOAuthコールバックサーバーを起動

### 1.2 一時停止/再開

- `comment-bot pause` / `comment-bot resume`
- 表示: 現在状態（running/paused）

### 1.3 安全レベル切替

- `comment-bot safety --level <strict|standard|relaxed>`
- 表示: 適用結果

### 1.4 停止

- `comment-bot stop`
- 動作: 起動中のWebサーバー/OAuthコールバックを確実にkill
- 表示: 停止結果（成功/エラー）

---

## 2. Web UI（Next.js, Vercel）

### 2.1 画面一覧

- /dashboard（Server Component）
  - 目的: 稼働状況の概要表示（保存せず短期表示）。ローカルエージェントの状態は将来の連携が前提
  - 表示項目（例）: 現在の設定スナップショット、選択プロバイダ、安全レベル
- /settings（Server Component + Server Actions）
  - 目的: YAML設定項目の編集（秘密/トークンは対象外）
  - 操作: フォーム編集→サーバーサイドでバリデーション→保存先
    - 保存先（選択）: Edge Config / KV / ダウンロード（ローカル反映用）
  - ガード: 外部APIはクライアントから呼ばない
- /safety（Server Component）
  - 目的: 安全レベルの切替、NG/推奨表現の編集
  - 保存: /settingsと同様のサーバーサイド保存

### 2.2 非機能/ガード

- クライアント直フェッチ禁止。Route Handlers/Server Actionsのみ使用
- 秘密/トークンは保持しない（A案）。ローカルエージェントでOAuth実施
- アクセシビリティ: WCAG 2.2準拠（コントラスト、フォーカス、キーボード操作）

### 2.3 例外表示

- 成功: 簡潔な1行
- 警告: 再試行方針を併記
- エラー: 要約と対応、詳細は記録しない/最小限（PIIマスク）

## 3. 実装に必要な事項

- **Next.js/Vercel前提**
  - App Router（v14+）、Server Components/Route Handlers/Server Actionsのみ使用
  - 長時間処理は禁止（STT/投稿はローカルで実行）
- **設定編集UI**
  - 入力項目: persona/tone/style, contentPolicy(ngWords/preferredPhrases/length), triggerPolicy,
    safety.level, stt/llm選択
  - バリデーション: サーバー側で厳格型チェック（`any`/`unknown`禁止）。エラー表示は簡潔
  - 保存先: Edge Config/KV/ダウンロード（秘密は保存しない）
- **アクセシビリティ**
  - ラベル/フォーカス管理/コントラスト（WCAG 2.2）
  - キーボード操作可能、aria属性の適正付与
- **ガード/セキュリティ**
  - クライアント直フェッチ禁止。全外部APIはサーバーサイド経由
  - CORS/CSRF対策（必要時）。機微情報の出力抑止
- **開発/ビルド**
  - Node LTS、ESLint、型エラーゼロでビルド通過

## 4. UIライブラリ選定（Web UI）

- スタイル: Tailwind CSS（一貫性/低コスト）
- UIプリミティブ: Radix UI（A11y強化）
- コンポーネント: shadcn/ui（Tailwind+Radixベース）
- フォーム: react-hook-form + zod（型安全・サーバー側検証と整合）
- アイコン: lucide-react
- 補助: next-themes（任意, ダークモード）, clsx/tailwind-merge（クラス合成）

注意:

- クライアント直フェッチは禁止。Server Actions/Route Handlersで保存/取得
- 大型UIフレームワーク（MUI/Chakra等）は現状非採用
